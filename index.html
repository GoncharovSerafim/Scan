<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∫–ª–∞–¥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }

        header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .controls {
            background: #34495e;
            padding: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .scanner-section {
            padding: 20px;
        }

        .status-bar {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .status-bar.add-mode {
            background: #fff3cd;
        }

        .status-bar.cart-mode {
            background: #d4edda;
        }

        .barcode-input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .tables-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .table-section {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }

        .table-section h3 {
            background: #2c3e50;
            color: white;
            padding: 10px;
            margin: 0;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f8f9fa;
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        td {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
        }

        .remove-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .cart-section {
            background: #f8f9fa;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .user-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .complete-btn {
            width: 100%;
            padding: 12px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .low-stock {
            color: #e74c3c;
            font-weight: bold;
        }

        .connection-status {
            padding: 8px 12px;
            text-align: center;
            font-size: 13px;
            border-radius: 5px;
            margin: 8px 20px;
        }

        .connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            text-align: center;
            color: #666;
            padding: 20px;
        }
    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
</head>
<body>
<div class="container">
    <header>
        <h1>üì¶ –°–∫–ª–∞–¥ - –°–∫–∞–Ω–µ—Ä —à—Ç—Ä–∏—Ö–∫–æ–¥–æ–≤</h1>
        <p>–¢–µ–ª–µ–∂–∫–∞: 12345678906</p>
    </header>

    <div id="connectionStatus" class="connection-status">
        üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase...
    </div>

    <div class="controls">
        <button class="btn btn-warning" onclick="toggleAddProductsMode()" id="addProductsBtn">
            üì¶ –†–µ–∂–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        </button>
        <button class="btn btn-primary" onclick="resetOperation()">üîÑ –°–±—Ä–æ—Å</button>
        <button class="btn btn-success" onclick="showAddProductModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
    </div>

    <div class="scanner-section">
        <div class="status-bar" id="statusBar">
            –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ —Ç–µ–ª–µ–∂–∫—É –∏–ª–∏ —Ç–æ–≤–∞—Ä
        </div>

        <input type="text" class="barcode-input" placeholder="üîç –°–∫–∞–Ω–∏—Ä—É–π—Ç–µ —à—Ç—Ä–∏—Ö–∫–æ–¥..." id="barcodeInput" autofocus>

        <div class="tables-container">
            <div class="table-section">
                <h3>üõí –¢–µ–ª–µ–∂–∫–∞</h3>
                <table id="cartTable">
                    <thead>
                    <tr>
                        <th>–¢–æ–≤–∞—Ä</th>
                        <th>–ö–æ–ª-–≤–æ</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody id="cartTableBody">
                    <tr>
                        <td colspan="3" style="text-align: center; color: #666; padding: 20px;">
                            –ü—É—Å—Ç–æ
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="table-section">
                <h3>üì¶ –ü–æ–ª–∫–∏</h3>
                <table id="shelvesTable">
                    <thead>
                    <tr>
                        <th>–¢–æ–≤–∞—Ä</th>
                        <th>–ù–∞–ª–∏—á–∏–µ</th>
                        <th>–®—Ç—Ä–∏—Ö–∫–æ–¥</th>
                    </tr>
                    </thead>
                    <tbody id="shelvesTableBody">
                    <tr>
                        <td colspan="3" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Firebase...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="cart-section">
            <input type="text" class="user-input" placeholder="üë§ –í–∞—à–µ –∏–º—è" id="userName">
            <button class="complete-btn" onclick="completeTransaction()">
                ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–¥–∞—á—É
            </button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
<div id="addProductModal"
     style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center;">
    <div style="background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px;">
        <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
        <input type="text" class="user-input" placeholder="–®—Ç—Ä–∏—Ö–∫–æ–¥" id="newBarcode">
        <input type="text" class="user-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" id="newName">
        <input type="number" class="user-input" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" id="newQuantity">
        <div style="display: flex; gap: 10px; margin-top: 15px;">
            <button class="btn btn-success" onclick="addProductToFirebase()" style="flex: 1;">–î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="btn btn-primary" onclick="hideAddProductModal()" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
</div>

<script>
    // üî• Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    const firebaseConfig = {
        apiKey: "AIzaSyBcFsu6uilMY_uxDMtbFJuoOc5_Bit3wQw",
        authDomain: "inventory-system-1a5b7.firebaseapp.com",
        projectId: "inventory-system-1a5b7",
        storageBucket: "inventory-system-1a5b7.firebasestorage.app",
        messagingSenderId: "674916814129",
        appId: "1:674916814129:web:df3973a98d2db2fd617410"
    };

    // üéØ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
    let state = {
        mode: null,
        currentCart: null,
        pendingProduct: null,
        cartContents: {},
        shelfContents: {}
    };

    let inventory = [];
    let db = null;

    // üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    async function init() {
        try {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();

            updateConnectionStatus('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase', 'connected');

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∫–∞–Ω–µ—Ä–∞
            const barcodeInput = document.getElementById('barcodeInput');
            barcodeInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    processScan(this.value.trim());
                    this.value = '';
                }
            });

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firebase
            await loadInventoryFromFirebase();

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ Firebase:', error);
            updateConnectionStatus('‚ùå –û—à–∏–±–∫–∞ Firebase', 'disconnected');
            loadDemoData();
        }
    }

    // üì• –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏–∑ Firebase
    async function loadInventoryFromFirebase() {
        try {
            const snapshot = await db.collection("inventory").get();
            inventory = [];
            state.shelfContents = {};

            snapshot.forEach(doc => {
                const product = {
                    id: doc.id,
                    ...doc.data()
                };
                inventory.push(product);
                state.shelfContents[product.barcode] = product.quantity;
            });

            updateDisplays();

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è:', error);
            loadDemoData();
        }
    }

    // ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ Firebase
    async function addProductToFirebase() {
        const barcode = document.getElementById('newBarcode').value.trim();
        const name = document.getElementById('newName').value.trim();
        const quantity = parseInt(document.getElementById('newQuantity').value);

        if (!barcode || !name || isNaN(quantity)) {
            alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
            return;
        }

        try {
            await db.collection("inventory").add({
                barcode: barcode,
                name: name,
                quantity: quantity,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            alert('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ Firebase');
            hideAddProductModal();
            await loadInventoryFromFirebase(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ

        } catch (error) {
            alert('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: ' + error.message);
        }
    }

    // üì® –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    async function processScan(barcode) {
        if (!barcode) return;

        // –†–ï–ñ–ò–ú –î–û–ë–ê–í–õ–ï–ù–ò–Ø - —Ç–æ–≤–∞—Ä—ã —Å—Ä–∞–∑—É –≤ —Ç–µ–ª–µ–∂–∫—É
        if (state.mode === 'add_products') {
            addProductToCart(barcode);
            return;
        }

        // –†–ï–ñ–ò–ú –¢–ï–õ–ï–ñ–ö–ê‚Üí–ü–û–õ–ö–ê - –≤–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–æ–≤
        if (state.mode === 'cart_to_shelf') {
            returnProductToShelf(barcode);
            return;
        }

        // –†–ï–ñ–ò–ú –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø - –∂–¥–µ–º —Ç–µ–ª–µ–∂–∫—É
        if (state.mode === 'confirm_product') {
            if (barcode === "12345678906") {
                await confirmProductToCart();
                resetOperation();
            } else {
                alert('–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ —Ç–µ–ª–µ–∂–∫—É');
            }
            return;
        }

        // –û–ë–´–ß–ù–´–ô –†–ï–ñ–ò–ú

        // –ù–∞—á–∏–Ω–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é –¢–ï–õ–ï–ñ–ö–ê‚Üí–ü–û–õ–ö–ê
        if (barcode === "12345678906") {
            state.mode = 'cart_to_shelf';
            state.currentCart = barcode;
            updateStatusBar("–†–µ–∂–∏–º: –¢–ï–õ–ï–ñ–ö–ê‚Üí–ü–û–õ–ö–ê. –°–∫–∞–Ω–∏—Ä—É–π—Ç–µ —Ç–æ–≤–∞—Ä –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞");
            return;
        }

        // –ù–∞—á–∏–Ω–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é –ü–û–õ–ö–ê‚Üí–¢–ï–õ–ï–ñ–ö–ê
        startProductToCart(barcode);
    }

    // ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ —Ç–µ–ª–µ–∂–∫—É (—Ä–µ–∂–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è)
    function addProductToCart(barcode) {
        const product = findProduct(barcode);
        if (product) {
            state.cartContents[barcode] = (state.cartContents[barcode] || 0) + 1;
            updateDisplays();
            alert(`‚úÖ ${product.name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ç–µ–ª–µ–∂–∫—É`);
        } else {
            alert('‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }
    }

    // üì§ –í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –ø–æ–ª–∫—É
    async function returnProductToShelf(barcode) {
        const product = findProduct(barcode);
        if (product) {
            if (state.cartContents[barcode] && state.cartContents[barcode] > 0) {
                state.cartContents[barcode]--;
                if (state.cartContents[barcode] === 0) {
                    delete state.cartContents[barcode];
                }
                state.shelfContents[barcode]++;

                // –û–±–Ω–æ–≤–ª—è–µ–º –≤ Firebase
                await updateProductQuantityInFirebase(product.id, state.shelfContents[barcode]);

                updateDisplays();
                alert(`‚úÖ ${product.name} –≤–æ–∑–≤—Ä–∞—â–µ–Ω –Ω–∞ –ø–æ–ª–∫—É`);
                resetOperation();
            } else {
                alert(`‚ùå –í —Ç–µ–ª–µ–∂–∫–µ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–∞ ${product.name}`);
            }
        } else {
            alert('‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }
    }

    // üéØ –ù–∞—á–∞–ª–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ü–û–õ–ö–ê‚Üí–¢–ï–õ–ï–ñ–ö–ê
    function startProductToCart(barcode) {
        const product = findProduct(barcode);
        if (product) {
            if (state.shelfContents[barcode] > 0) {
                state.mode = 'confirm_product';
                state.pendingProduct = barcode;
                updateStatusBar(`${product.name}. –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ —Ç–µ–ª–µ–∂–∫—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è`);
            } else {
                alert(`‚ùå –ù–∞ –ø–æ–ª–∫–µ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–∞ ${product.name}`);
            }
        } else {
            alert('‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }
    }

    // ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
    async function confirmProductToCart() {
        if (state.pendingProduct) {
            const barcode = state.pendingProduct;
            const product = findProduct(barcode);

            if (product && state.shelfContents[barcode] > 0) {
                state.shelfContents[barcode]--;
                state.cartContents[barcode] = (state.cartContents[barcode] || 0) + 1;

                // –û–±–Ω–æ–≤–ª—è–µ–º –≤ Firebase
                await updateProductQuantityInFirebase(product.id, state.shelfContents[barcode]);

                updateDisplays();
                alert(`‚úÖ ${product.name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ç–µ–ª–µ–∂–∫—É`);
            }
        }
    }

    // üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤ Firebase
    async function updateProductQuantityInFirebase(productId, newQuantity) {
        try {
            await db.collection("inventory").doc(productId).update({
                quantity: newQuantity,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:', error);
        }
    }

    // ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–¥–∞—á–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ Firebase
    async function completeTransaction() {
        const userName = document.getElementById('userName').value.trim();

        if (!userName) {
            alert('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
            return;
        }

        if (Object.keys(state.cartContents).length === 0) {
            alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
            return;
        }

        try {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ Firebase
            const transaction = {
                userName: userName,
                items: Object.entries(state.cartContents).map(([barcode, quantity]) => {
                    const product = findProduct(barcode);
                    return {
                        barcode: barcode,
                        name: product ? product.name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä',
                        quantity: quantity
                    };
                }),
                totalItems: Object.values(state.cartContents).reduce((sum, qty) => sum + qty, 0),
                date: new Date().toISOString(),
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            await db.collection("transactions").add(transaction);


            const totalItems = Object.values(state.cartContents).reduce((sum, qty) => sum + qty, 0);
            alert(`‚úÖ –í—ã–¥–∞—á–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞ –¥–ª—è ${userName}\n–¢–æ–≤–∞—Ä–æ–≤: ${totalItems}\n–ü–æ–∑–∏—Ü–∏–π: ${Object.keys(state.cartContents).length}`);

            // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
            state.cartContents = {};
            updateDisplays();
            document.getElementById('userName').value = '';

        } catch (error) {
            alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –≤—ã–¥–∞—á–∏: ' + error.message);
        }
    }

    // üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
    function toggleAddProductsMode() {
        const btn = document.getElementById('addProductsBtn');

        if (state.mode === 'add_products') {
            state.mode = null;
            btn.textContent = 'üì¶ –†–µ–∂–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è';
            btn.className = 'btn btn-warning';
            updateStatusBar('–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ —Ç–µ–ª–µ–∂–∫—É –∏–ª–∏ —Ç–æ–≤–∞—Ä');
        } else {
            state.mode = 'add_products';
            btn.textContent = '‚ùå –í—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞';
            btn.className = 'btn btn-primary';
            updateStatusBar('–†–µ–∂–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è. –°–∫–∞–Ω–∏—Ä—É–π—Ç–µ —Ç–æ–≤–∞—Ä—ã');
        }
    }

    // üóëÔ∏è –°–±—Ä–æ—Å –æ–ø–µ—Ä–∞—Ü–∏–∏
    function resetOperation() {
        state.mode = null;
        state.currentCart = null;
        state.pendingProduct = null;
        updateStatusBar('–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ —Ç–µ–ª–µ–∂–∫—É –∏–ª–∏ —Ç–æ–≤–∞—Ä');
    }

    // üìä –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    function updateDisplays() {
        updateCartTable();
        updateShelvesTable();
    }

    function updateCartTable() {
        const tbody = document.getElementById('cartTableBody');

        if (Object.keys(state.cartContents).length === 0) {
            tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #666; padding: 20px;">–ü—É—Å—Ç–æ</td></tr>';
            return;
        }

        tbody.innerHTML = Object.entries(state.cartContents)
            .map(([barcode, quantity]) => {
                const product = findProduct(barcode);
                if (!product) return '';

                return `
                    <tr>
                        <td>${product.name}</td>
                        <td>${quantity}</td>
                        <td>
                            <button class="remove-btn" onclick="removeFromCart('${barcode}')">
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </td>
                    </tr>
                `;
            })
            .join('');
    }

    function updateShelvesTable() {
        const tbody = document.getElementById('shelvesTableBody');

        tbody.innerHTML = inventory
            .map(product => {
                const quantity = state.shelfContents[product.barcode] || 0;
                const isLowStock = quantity <= 2;

                return `
                    <tr>
                        <td>${product.name}</td>
                        <td class="${isLowStock ? 'low-stock' : ''}">
                            ${quantity} ${isLowStock ? '‚ö†Ô∏è' : ''}
                        </td>
                        <td><small>${product.barcode}</small></td>
                    </tr>
                `;
            })
            .join('');
    }

    // ‚ùå –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
    function removeFromCart(barcode) {
        if (state.cartContents[barcode]) {
            state.shelfContents[barcode] += state.cartContents[barcode];
            delete state.cartContents[barcode];
            updateDisplays();
            alert('‚úÖ –¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ —Ç–µ–ª–µ–∂–∫–∏');
        }
    }

    // üîß –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function findProduct(barcode) {
        return inventory.find(p => p.barcode === barcode);
    }

    function updateStatusBar(text) {
        document.getElementById('statusBar').textContent = text;
    }

    function updateConnectionStatus(text, className) {
        const status = document.getElementById('connectionStatus');
        status.textContent = text;
        status.className = `connection-status ${className}`;
    }

    function showAddProductModal() {
        document.getElementById('addProductModal').style.display = 'flex';
    }

    function hideAddProductModal() {
        document.getElementById('addProductModal').style.display = 'none';
    }

    // üìù –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–∫–∏
    function loadDemoData() {
        inventory = [
            {
                id: '1',
                barcode: '12345678909',
                name: '–°–∫–∞–Ω–µ—Ä 2D',
                quantity: 5
            },
            {
                barcode: '12345678908',
                name: 'Micro-USB –ø–æ—Ä—Ç',
                quantity: 15
            },
            {
                barcode: '83957295632',
                name: '–§–ª–µ—à–∫–∞ 8–ì–ë',
                quantity: 8
            }
        ];

        inventory.forEach(product => {
            state.shelfContents[product.barcode] = product.quantity;
        });

        updateDisplays();
        updateConnectionStatus('‚ö†Ô∏è –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º', 'disconnected');
    }

    // üöÄ –ó–∞–ø—É—Å–∫
    window.onload = init;
</script>
</body>
</html>

